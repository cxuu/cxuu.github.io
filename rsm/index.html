<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <link rel="icon" href="/assets/images/logo.png"> <title>Reliable & Consistent Service: Linearizable RPC and Replicated State Machine | Charles Xu</title> <title>Reliable &amp; Consistent Service: Linearizable RPC and Replicated State Machine | Charles Xu</title> <meta name="generator" content="Jekyll v4.3.2"/> <meta property="og:title" content="Reliable &amp; Consistent Service: Linearizable RPC and Replicated State Machine"/> <meta property="og:locale" content="en_US"/> <meta name="description" content="Remote Procedure Call (RPC) is a canonical structuring paradigm for client-server/request-response services."/> <meta property="og:description" content="Remote Procedure Call (RPC) is a canonical structuring paradigm for client-server/request-response services."/> <meta property="og:site_name" content="Charles Xu"/> <meta property="og:image" content="/assets/images/rsm/cover.png"/> <meta property="og:type" content="article"/> <meta property="article:published_time" content="2016-09-13T00:00:00+00:00"/> <meta name="twitter:card" content="summary_large_image"/> <meta property="twitter:image" content="/assets/images/rsm/cover.png"/> <meta property="twitter:title" content="Reliable &amp; Consistent Service: Linearizable RPC and Replicated State Machine"/> <script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2016-09-13T00:00:00+00:00","datePublished":"2016-09-13T00:00:00+00:00","description":"Remote Procedure Call (RPC) is a canonical structuring paradigm for client-server/request-response services.","headline":"Reliable &amp; Consistent Service: Linearizable RPC and Replicated State Machine","image":"/assets/images/rsm/cover.png","mainEntityOfPage":{"@type":"WebPage","@id":"/rsm/"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"/assets/images/logo.png"}},"url":"/rsm/"}</script> <link href="/assets/css/bootstrap.min.css" rel="stylesheet"> <script src="/assets/js/jquery.min.js"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-8CYZ0N0EWJ"></script> <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-8CYZ0N0EWJ");</script> <script>!function(e,t,a,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=t.createElement(a),s=t.getElementsByTagName(a)[0],o.async=1,o.src=n,s.parentNode.insertBefore(o,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-151349369-1","auto"),ga("send","pageview");</script> <script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "5b6e3d4ee3274005a2d3321f9bb0516c"}'></script> </head> <body class="layout-post"> <noscript id="deferred-styles"> <link href="/assets/css/fontawesome.css" rel="stylesheet"> <link href="/assets/css/google-fonts.css" rel="stylesheet"> </noscript> <nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down"> <div class="container pr-0"> <a class="navbar-brand" href="/"> <img src="/assets/images/logo.png" alt="Charles Xu" height="32" width="32"> </a> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMediumish" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <div class="collapse navbar-collapse" id="navbarMediumish"> <ul class="navbar-nav ml-auto"> <li class="nav-item"> <a class="nav-link" href="/about">About</a> </li> <li class="nav-item"> <a class="nav-link" href="/bookshelf">Bookshelf</a> </li> <li class="nav-item"> <a class="nav-link" href="/inspirations">Inspirations</a> </li> <li class="nav-item"> <a class="nav-link" href="/wiki">Wiki</a> </li> <li class="nav-item"> <a class="nav-link" href="/">Blog</a> </li> <script src="/assets/js/lunr.js"></script> <style>.lunrsearchresult .title{color:#d9230f}.lunrsearchresult .url{color:silver}.lunrsearchresult a{display:block;color:#777}.lunrsearchresult a:hover,.lunrsearchresult a:focus{text-decoration:none}.lunrsearchresult a:hover .title{text-decoration:underline}</style> <div style="width: 14px; height: 10px;"></div> <form class="bd-search" onSubmit="return lunr_search(document.getElementById('lunrsearch').value);"> <input type="text" class="form-control text-small launch-modal-search" id="lunrsearch" name="q" maxlength="255" value="" placeholder="Type and enter..."/> </form> <div id="lunrsearchresults"> <ul></ul> </div> <script src="/assets/js/lunrsearchengine.js"></script> </ul> </div> </div> </nav> <div class="site-content"> <div class="container"> <div class="mainheading"> <h1 class="sitetitle">Charles Xu</h1> <p class="lead"> Essays, books, wiki on technologies, career, markets, and more. </p> </div> <div id="loading"> <div id="loading-image" class="lds-ellipsis"><div></div><div></div><div></div><div></div></div> </div> <script>$(window).on("load",function(){$("#loading").hide()});</script> <div class="main-content"> <div class="container"> <div class="row"> <div class="col-md-2 pl-0"> <div class="share sticky-top sticky-top-offset"> <p> Share </p> <ul> <li class="ml-1 mr-1"> <a target="_blank" href="https://twitter.com/intent/tweet?text=Reliable & Consistent Service: Linearizable RPC and Replicated State Machine&url=charlesxu.io/rsm/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;"> <i class="fab fa-twitter"></i> </a> </li> <li class="ml-1 mr-1"> <a target="_blank" href="https://facebook.com/sharer.php?u=charlesxu.io/rsm/" onclick="window.open(this.href, 'facebook-share', 'width=550,height=435');return false;"> <i class="fab fa-facebook-f"></i> </a> </li> <li class="ml-1 mr-1"> <a target="_blank" href="https://www.linkedin.com/shareArticle?mini=true&url=charlesxu.io/rsm/" onclick="window.open(this.href, 'width=550,height=435');return false;"> <i class="fab fa-linkedin-in"></i> </a> </li> </ul> <div class="sep"> </div> <ul> <li> <a class="small smoothscroll" href="#disqus_thread"></a> </li> </ul> </div> </div> <div class="col-md-8 flex-first flex-md-unordered"> <div class="mainheading"> <h1 class="posttitle">Reliable & Consistent Service: Linearizable RPC and Replicated State Machine</h1> </div> <img class="featured-image img-fluid lazyimg" style="min-width: 100%" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAACCAQAAAA3fa6RAAAADklEQVR42mNkAANGCAUAACMAA2w/AMgAAAAASUVORK5CYII=" data-src="/assets/images/rsm/cover.png" alt="Reliable & Consistent Service: Linearizable RPC and Replicated State Machine"> <div class="article-post"> <p>Remote Procedure Call (RPC) is a canonical structuring paradigm for client-server/request-response services.</p> <div style="text-align: center"> <p><img src="/assets/images/rsm/1.png" width="600px"/></p> </div> <p>This simplified diagram overlooks the challenges we face such as unreliable networks and remote server crash and recovery. In the famous Birrell/Nelson paper, at-most-once semantics was proposed that request is resent upon timeout so it eventually does reach the server, and that server is stateless so it restarts when failed and continues service probably retransmitted request (a failed server is a slow server).</p> <p>But then a request might be retransmitted right before the response arrives so that the operation might be executed twice.</p> <div style="text-align: center"> <p><img src="/assets/images/rsm/2.png" width="250px"/></p> </div> <p>In the 80s, people believe that requests are essentially read and write, both of which are idempotent, meaning executing them twice will not change the response, so at-least-once semantics are fine. For a long time, we thought at-least-once semantics + idempotent operations = linearizable RPC, but it turns out it is not necessarily true. Consider the following example. The very last read should return 3 in a linearizable system. The takeaway is we need exactly-once semantics.</p> <div style="text-align: center"> <p><img src="/assets/images/rsm/3.png" width="570px"/></p> </div> <p>Reply cache has come to rescue. Each RPC is tagged with an id and its return value is put in the reply cache such that when the retransmitted RPC arrives, the server does not re-execute and return the value in cache immediately. The cache entry is evicted when the client ACKs. Using a reply cache achieves at-most-once semantics, which combined with retransmission achieves exactly-once semantics.</p> <p>But what about failovers? When an instance of the server fails, all loads are shifted to other servers. To get consistent results requires the reply cache to be durable, which means each operation replicated across the entire server grid. This is why linearizability is so important. A concurrent implementation is correct if its behavior is equivalent to some serial order. Each server could be viewed as a state machine and with a sequence (linearized) of applied actions, its final state is deterministic and could be replicated. Paxos, Viewstamped Replication, Raft are all consensus algorithms for replication.</p> <p>The one last twist is that upon failovers, the client needs to keep track of the new elected master/leader and send requests to her. Of course, the client application is not the one to do such bookkeeping.</p> <div style="text-align: center"> <p><img src="/assets/images/rsm/4.png" width="600px"/></p> </div> <p>Take Viewstamped Replication for example. VR Proxy on the client side keeps track of the current master. On the server side, it is the VR code that manages replication, election, etc. It is therefore independent of the underlying server code and could be reused readily.</p> <div style="text-align: center"> <p><img src="/assets/images/rsm/5.png" width="600px"/></p> </div> </div> <p> <small> <span class="post-date"><time class="post-date" datetime="2016-09-13">13 Sep 2016</time></span> </small> </p> <div class="after-post-cats"> <ul class="tags mb-4"> <li> <a class="smoothscroll" href="/categories#distributed-systems">distributed systems</a> </li> </ul> </div> <div class="after-post-tags"> <ul class="tags"> </ul> </div> <div class="row PageNavigation d-flex justify-content-between font-weight-bold"> <a class="prev d-block col-md-6" href="/microservices/"> &laquo; Service-Oriented Architecture: Why did Microservices Catch On</a> <a class="next d-block col-md-6 text-lg-right" href="/fourier/">Fourier, Phasors, LTI and All That &raquo; </a> <div class="clearfix"></div> </div> </div> </div> </div> </div> <div class="alertbar"> <div class="container text-center"> <span><img src="/assets/images/logo.png" alt="Charles Xu" height="32" width="32"> &nbsp; Never miss a <b>story</b> from me, subscribe to my newsletter</span> <form action="https://gmail.us5.list-manage.com/subscribe/post?u=b3d456844a3860642cd584c1b&amp;id=3f0c5c8bcd" method="post" name="mc-embedded-subscribe-form" class="wj-contact-form validate" target="_blank" novalidate> <div class="mc-field-group"> <input type="email" placeholder="Email" name="EMAIL" class="required email" id="mce-EMAIL" autocomplete="on" required> <input type="submit" value="Subscribe" name="subscribe" class="heart"> </div> </form> </div> </div> </div> <div class="jumbotron fortags"> <div class="d-md-flex h-100"> <div class="col-md-4 transpdark align-self-center text-center h-100"> <div class="d-md-flex align-items-center justify-content-center h-100"> <h2 class="d-md-block align-self-center py-1 font-weight-light">Explore <span class="d-none d-md-inline">→</span></h2> </div> </div> <div class="col-md-8 p-5 align-self-center text-center"> <a class="mt-1 mb-1" href="/categories#git">git (3)</a> <a class="mt-1 mb-1" href="/categories#web">web (6)</a> <a class="mt-1 mb-1" href="/categories#microservices">microservices (3)</a> <a class="mt-1 mb-1" href="/categories#distributed-systems">distributed systems (4)</a> <a class="mt-1 mb-1" href="/categories#signal-processing">signal processing (1)</a> <a class="mt-1 mb-1" href="/categories#istio">istio (3)</a> <a class="mt-1 mb-1" href="/categories#security">security (1)</a> <a class="mt-1 mb-1" href="/categories#docker">docker (2)</a> <a class="mt-1 mb-1" href="/categories#interview">interview (2)</a> <a class="mt-1 mb-1" href="/categories#kubernetes">kubernetes (7)</a> <a class="mt-1 mb-1" href="/categories#operation">operation (2)</a> <a class="mt-1 mb-1" href="/categories#networking">networking (5)</a> <a class="mt-1 mb-1" href="/categories#career">career (5)</a> <a class="mt-1 mb-1" href="/categories#go">go (1)</a> <a class="mt-1 mb-1" href="/categories#shell">shell (1)</a> <a class="mt-1 mb-1" href="/categories#investment">investment (1)</a> <a class="mt-1 mb-1" href="/categories#law">law (1)</a> <a class="mt-1 mb-1" href="/categories#startup">startup (4)</a> <a class="mt-1 mb-1" href="/categories#accounting">accounting (1)</a> <a class="mt-1 mb-1" href="/categories#oss">oss (1)</a> <a class="mt-1 mb-1" href="/categories#sales">sales (1)</a> <a class="mt-1 mb-1" href="/categories#advice">advice (1)</a> <a class="mt-1 mb-1" href="/categories#cloud">cloud (2)</a> </div> </div> </div> <footer class="footer"> <div class="container"> <div class="row"> <div class="col-md-6 col-sm-6 text-center text-lg-left" style="margin-bottom: 10px;"> Copyright © 2016-2023 Charles Xu </div> </div> </div> </footer> </div> <script src="/assets/js/popper.min.js"></script> <script src="/assets/js/bootstrap.min.js"></script> <script src="/assets/js/mediumish.js"></script> <script src="/assets/js/lazyload.js"></script> <script src="/assets/js/ie10-viewport-bug-workaround.js"></script> <link href="/assets/css/screen.css" rel="stylesheet"> <link href="/assets/css/main.css" rel="stylesheet"> </body> </html>