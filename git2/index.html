<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <link rel="icon" href="/assets/images/logo.png"> <title>Git: Branch off An Unmerged Branch While Committing Often - Disasters and Salvage | Charles Xu</title> <title>Git: Branch off An Unmerged Branch While Committing Often - Disasters and Salvage | Charles Xu</title> <meta name="generator" content="Jekyll v4.2.0"/> <meta property="og:title" content="Git: Branch off An Unmerged Branch While Committing Often - Disasters and Salvage"/> <meta property="og:locale" content="en_US"/> <meta name="description" content="Committing often and pushing often has been advocated as good practice when using Git, which saves your latest work on remote even if your hard drive dies right after and which provides a more fine-grained selection when rolling back."/> <meta property="og:description" content="Committing often and pushing often has been advocated as good practice when using Git, which saves your latest work on remote even if your hard drive dies right after and which provides a more fine-grained selection when rolling back."/> <meta property="og:site_name" content="Charles Xu"/> <meta property="og:image" content="/assets/images/git2/cover.jpg"/> <meta property="og:type" content="article"/> <meta property="article:published_time" content="2016-08-14T00:00:00-07:00"/> <meta name="twitter:card" content="summary_large_image"/> <meta property="twitter:image" content="/assets/images/git2/cover.jpg"/> <meta property="twitter:title" content="Git: Branch off An Unmerged Branch While Committing Often - Disasters and Salvage"/> <script type="application/ld+json">
{"mainEntityOfPage":{"@type":"WebPage","@id":"/git2/"},"url":"/git2/","image":"/assets/images/git2/cover.jpg","headline":"Git: Branch off An Unmerged Branch While Committing Often - Disasters and Salvage","dateModified":"2016-08-14T00:00:00-07:00","datePublished":"2016-08-14T00:00:00-07:00","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"/assets/images/logo.png"}},"description":"Committing often and pushing often has been advocated as good practice when using Git, which saves your latest work on remote even if your hard drive dies right after and which provides a more fine-grained selection when rolling back.","@type":"BlogPosting","@context":"https://schema.org"}</script> <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous"> <script src="/assets/js/jquery.min.js"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-8CYZ0N0EWJ"></script> <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-8CYZ0N0EWJ");</script> <script>!function(e,t,a,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=t.createElement(a),s=t.getElementsByTagName(a)[0],o.async=1,o.src=n,s.parentNode.insertBefore(o,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-151349369-1","auto"),ga("send","pageview");</script> <script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "5b6e3d4ee3274005a2d3321f9bb0516c"}'></script> </head> <body class="layout-post"> <noscript id="deferred-styles"> <link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel="stylesheet"> <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous"> </noscript> <nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down"> <div class="container pr-0"> <a class="navbar-brand" href="/"> <img src="/assets/images/logo.png" alt="Charles Xu" height="32" width="32"> </a> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMediumish" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <div class="collapse navbar-collapse" id="navbarMediumish"> <ul class="navbar-nav ml-auto"> <li class="nav-item"> <a class="nav-link" href="/about">About</a> </li> <li class="nav-item"> <a class="nav-link" href="/bookshelf">Bookshelf</a> </li> <li class="nav-item"> <a class="nav-link" href="/inspirations">Inspirations</a> </li> <li class="nav-item"> <a class="nav-link" href="/wiki">Wiki</a> </li> <li class="nav-item"> <a class="nav-link" href="/">Blog</a> </li> <script src="/assets/js/lunr.js"></script> <style>.lunrsearchresult .title{color:#d9230f}.lunrsearchresult .url{color:silver}.lunrsearchresult a{display:block;color:#777}.lunrsearchresult a:hover,.lunrsearchresult a:focus{text-decoration:none}.lunrsearchresult a:hover .title{text-decoration:underline}</style> <div style="width: 14px; height: 10px;"></div> <form class="bd-search" onSubmit="return lunr_search(document.getElementById('lunrsearch').value);"> <input type="text" class="form-control text-small launch-modal-search" id="lunrsearch" name="q" maxlength="255" value="" placeholder="Type and enter..."/> </form> <div id="lunrsearchresults"> <ul></ul> </div> <script src="/assets/js/lunrsearchengine.js"></script> </ul> </div> </div> </nav> <div class="site-content"> <div class="container"> <div class="mainheading"> <h1 class="sitetitle">Charles Xu</h1> <p class="lead"> Essays, books, wiki on technologies, career, markets, and more. </p> </div> <div class="main-content"> <div class="container"> <div class="row"> <div class="col-md-2 pl-0"> <div class="share sticky-top sticky-top-offset"> <p> Share </p> <ul> <li class="ml-1 mr-1"> <a target="_blank" href="https://twitter.com/intent/tweet?text=Git: Branch off An Unmerged Branch While Committing Often - Disasters and Salvage&url=charlesxu.io/git2/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;"> <i class="fab fa-twitter"></i> </a> </li> <li class="ml-1 mr-1"> <a target="_blank" href="https://facebook.com/sharer.php?u=charlesxu.io/git2/" onclick="window.open(this.href, 'facebook-share', 'width=550,height=435');return false;"> <i class="fab fa-facebook-f"></i> </a> </li> <li class="ml-1 mr-1"> <a target="_blank" href="https://www.linkedin.com/shareArticle?mini=true&url=charlesxu.io/git2/" onclick="window.open(this.href, 'width=550,height=435');return false;"> <i class="fab fa-linkedin-in"></i> </a> </li> </ul> <div class="sep"> </div> <ul> <li> <a class="small smoothscroll" href="#disqus_thread"></a> </li> </ul> </div> </div> <div class="col-md-8 flex-first flex-md-unordered"> <div class="mainheading"> <h1 class="posttitle">Git: Branch off An Unmerged Branch While Committing Often - Disasters and Salvage</h1> </div> <img class="featured-image img-fluid lazyimg" style="min-width: 100%" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAACCAQAAAA3fa6RAAAADklEQVR42mNkAANGCAUAACMAA2w/AMgAAAAASUVORK5CYII=" data-src="/assets/images/git2/cover.jpg" alt="Git: Branch off An Unmerged Branch While Committing Often - Disasters and Salvage"> <div class="article-post"> <p>Committing often and pushing often has been advocated as good practice when using Git, which saves your latest work on remote even if your hard drive dies right after and which provides a more fine-grained selection when rolling back.</p> <p>It is also good practice to make each pull request consist of only one commit, so that it is easier to cherry-pick stable features from <code class="language-plaintext highlighter-rouge">master</code> to release branch. So what I do is to squash all commits into one right before I send them out for review.</p> <p>Sometimes, I would branch off the current branch I was working on but was blocked when the project was building/compiling or my reviewers have yet to get back to me. It works out by having multiple local repos in different directories.</p> <p>The problem comes in when I later make more commits onto the original branch I just branched off, as illustrated below.</p> <div style="text-align: center"> <p><img src="/assets/images/git2/1.png" width="350px"/></p> </div> <p>Say we rebase from the <code class="language-plaintext highlighter-rouge">master</code> branch at commit <code class="language-plaintext highlighter-rouge">C0</code>, and we branch off from <em>Feature A</em> at commit <code class="language-plaintext highlighter-rouge">C1</code> to work on <em>Feature B</em>. Later, our reviewers finally got back to us and we continue work on <em>Feature A</em> to create commits <code class="language-plaintext highlighter-rouge">C2</code> and <code class="language-plaintext highlighter-rouge">C5</code>. Now <em>Feature A</em> is ready for the pull request if squashed. The problem shows up when some files are touched by both the branch <em>Feature A</em> and <em>Feature B</em>. If we squash <em>Feature A</em>, submit the pull request from <em>Feature A</em> against <code class="language-plaintext highlighter-rouge">master</code>, and finally rebase <em>Feature B</em> from <code class="language-plaintext highlighter-rouge">master</code>, crazy merge conflicts arise.</p> <div style="text-align: center"> <p><img src="/assets/images/git2/2.png" width="380px"/></p> </div> <p>The conflict results from the fact that both <em>Feature A</em> and <em>Feature B</em> touch the same files and that we rewrite history by squashing (interactive rebase) all commits of <em>Feature A</em>, including those between <code class="language-plaintext highlighter-rouge">C0</code> and <code class="language-plaintext highlighter-rouge">C1</code>. Now <code class="language-plaintext highlighter-rouge">S0</code> is a new commit different from any of <em>Feature B</em>, and the merge conflicts really is about the conflict between <code class="language-plaintext highlighter-rouge">S0</code> and <code class="language-plaintext highlighter-rouge">C0</code>-<code class="language-plaintext highlighter-rouge">C1</code>.</p> <p>Resolving this conflict by hand is a nightmare, because Git applies commits one by one chronologically, which means we have to resolve the conflict again and again until the last commit.</p> <p>I encountered this problem in my last internship. At first, I tried to resolve all conflicts by hand and it was not pretty and took me an hour to do so. This problem kept showing up and I believe there must be some other way.</p> <p>I did eventually find a solution.</p> <div style="text-align: center"> <p><img src="/assets/images/git2/3.png" width="700px"/></p> </div> <p>I first squash all commits on <em>Feature B</em> right until the one it branches off <em>Feature A</em>. Then, squash <em>Feature A</em> until C0. Notice that <code class="language-plaintext highlighter-rouge">S2</code> is now dangling as its parent is not in the source tree anymore.  Then, instead of a merge, cherry-pick <code class="language-plaintext highlighter-rouge">S2</code> to apply onto <code class="language-plaintext highlighter-rouge">S1</code>, and do a hard reset to have <em>Feature B</em> point to the new commit.</p> <p>Now approve the pull request to merge <code class="language-plaintext highlighter-rouge">S1</code> to <code class="language-plaintext highlighter-rouge">master</code>. After that, when you checkout <em>Feature B</em> and do a rebase from <code class="language-plaintext highlighter-rouge">master</code>, since the exact S1 is already in <code class="language-plaintext highlighter-rouge">master</code>, no conflicts arise because of <em>Feature A</em>. (there might still be conflicts of course if your teammate pushed the delta on the same files right before you rebase).</p> <p>The bane of the problem might just be that the Git way of taking snapshots of a branch, in that it allows the coexistence of multiple snapshots (i.e. commits) on a branch, which only comes in handy on fine-grained rollback but also brings more trouble in a more common setting in my opinion. Google uses customized Piper for version control, in which deltas are submitted in the quantum of a change list of files, which minimizes the problem encountered here.</p> </div> <p> <small> <span class="post-date"><time class="post-date" datetime="2016-08-14">14 Aug 2016</time></span> </small> </p> <div class="after-post-cats"> <ul class="tags mb-4"> <li> <a class="smoothscroll" href="/categories#git">git</a> </li> </ul> </div> <div class="after-post-tags"> <ul class="tags"> </ul> </div> <div class="row PageNavigation d-flex justify-content-between font-weight-bold"> <a class="next d-block col-md-6 text-lg-right" href="/microservices/">Service-Oriented Architecture: Why did Microservices Catch On &raquo; </a> <div class="clearfix"></div> </div> </div> </div> </div> </div> <div class="alertbar"> <div class="container text-center"> <span><img src="/assets/images/logo.png" alt="Charles Xu" height="32" width="32"> &nbsp; Never miss a <b>story</b> from me, subscribe to my newsletter</span> <form action="https://gmail.us5.list-manage.com/subscribe/post?u=b3d456844a3860642cd584c1b&amp;id=3f0c5c8bcd" method="post" name="mc-embedded-subscribe-form" class="wj-contact-form validate" target="_blank" novalidate> <div class="mc-field-group"> <input type="email" placeholder="Email" name="EMAIL" class="required email" id="mce-EMAIL" autocomplete="on" required> <input type="submit" value="Subscribe" name="subscribe" class="heart"> </div> </form> </div> </div> </div> <div class="jumbotron fortags"> <div class="d-md-flex h-100"> <div class="col-md-4 transpdark align-self-center text-center h-100"> <div class="d-md-flex align-items-center justify-content-center h-100"> <h2 class="d-md-block align-self-center py-1 font-weight-light">Explore <span class="d-none d-md-inline">→</span></h2> </div> </div> <div class="col-md-8 p-5 align-self-center text-center"> <a class="mt-1 mb-1" href="/categories#git">git (3)</a> <a class="mt-1 mb-1" href="/categories#web">web (6)</a> <a class="mt-1 mb-1" href="/categories#microservices">microservices (3)</a> <a class="mt-1 mb-1" href="/categories#distributed-systems">distributed systems (4)</a> <a class="mt-1 mb-1" href="/categories#signal-processing">signal processing (1)</a> <a class="mt-1 mb-1" href="/categories#istio">istio (3)</a> <a class="mt-1 mb-1" href="/categories#security">security (1)</a> <a class="mt-1 mb-1" href="/categories#docker">docker (2)</a> <a class="mt-1 mb-1" href="/categories#interview">interview (1)</a> <a class="mt-1 mb-1" href="/categories#kubernetes">kubernetes (5)</a> <a class="mt-1 mb-1" href="/categories#operation">operation (2)</a> <a class="mt-1 mb-1" href="/categories#networking">networking (3)</a> <a class="mt-1 mb-1" href="/categories#career">career (4)</a> <a class="mt-1 mb-1" href="/categories#go">go (1)</a> <a class="mt-1 mb-1" href="/categories#shell">shell (1)</a> <a class="mt-1 mb-1" href="/categories#investment">investment (1)</a> <a class="mt-1 mb-1" href="/categories#law">law (1)</a> <a class="mt-1 mb-1" href="/categories#startup">startup (2)</a> <a class="mt-1 mb-1" href="/categories#accounting">accounting (1)</a> </div> </div> </div> <footer class="footer"> <div class="container"> <div class="row"> <div class="col-md-6 col-sm-6 text-center text-lg-left" style="margin-bottom: 10px;"> Copyright © 2016-2022 Charles Xu </div> </div> </div> </footer> </div> <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script> <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script> <script src="/assets/js/mediumish.js"></script> <script src="/assets/js/lazyload.js"></script> <script src="/assets/js/ie10-viewport-bug-workaround.js"></script> <link href="/assets/css/screen.css" rel="stylesheet"> <link href="/assets/css/main.css" rel="stylesheet"> </body> </html>